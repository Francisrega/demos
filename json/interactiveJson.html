<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Oracle JSON Relational Duality - Interactive Demo</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      min-height: 100vh;
      padding: 20px;
      color: #2c3e50;
    }
    
    .container {
      max-width: 1600px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }
    
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 30px;
      font-size: 2.2em;
    }
    
    .controls {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .button-row {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    
    .label {
      font-weight: bold;
      margin: 15px 0 10px 0;
      text-align: center;
      color: #2c3e50;
    }
    
    button {
      padding: 12px 20px;
      border: none;
      border-radius: 25px;
      font-weight: bold;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }
    
    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    .btn-special {
      background: linear-gradient(45deg, #8e44ad, #9b59b6);
      color: white;
      font-size: 16px;
      padding: 15px 30px;
    }
    
    .btn-primary {
      background: linear-gradient(45deg, #3498db, #2980b9);
      color: white;
    }
    
    .btn-success {
      background: linear-gradient(45deg, #27ae60, #229954);
      color: white;
    }
    
    .btn-warning {
      background: linear-gradient(45deg, #f39c12, #e67e22);
      color: white;
    }
    
    .btn-danger {
      background: linear-gradient(45deg, #e74c3c, #c0392b);
      color: white;
    }
    
    .main-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .panel {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    
    .panel-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 3px solid #e74c3c;
    }
    
    .panel-title {
      font-size: 1.2rem;
      font-weight: bold;
    }
    
    .code-display {
      background: #1e1e1e;
      color: #d4d4d4;
      font-family: 'Courier New', monospace;
      padding: 15px;
      border-radius: 10px;
      min-height: 350px;
      overflow: auto;
      white-space: pre;
      font-size: 13px;
      line-height: 1.5;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
    }
    
    th {
      background: #34495e;
      color: white;
      padding: 10px;
      text-align: left;
      font-size: 14px;
    }
    
    td {
      padding: 10px;
      border-bottom: 1px solid #ecf0f1;
      font-size: 14px;
    }
    
    tr:hover td {
      background: #f8f9fa;
    }
    
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #2c3e50;
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      display: none;
      z-index: 1000;
    }
    
    .toast.show {
      display: block;
      animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
      from { transform: translateX(-50%) translateY(-100%); }
      to { transform: translateX(-50%) translateY(0); }
    }
    
    .sql-keyword { color: #569cd6; font-weight: bold; }
    .sql-string { color: #ce9178; }
    .sql-number { color: #b5cea8; }
    
    .inactive {
      opacity: 0.3;
      pointer-events: none;
    }
    
    .duality-badge {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(45deg, #8e44ad, #9b59b6);
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 1.2rem;
      display: none;
      z-index: 10;
    }
    
    .duality-badge.show {
      display: block;
    }
    
    @media (max-width: 1200px) {
      .main-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Oracle JSON Relational Duality ‚Äì Interactive Demo</h1>
    
    <div class="controls">
      <div class="button-row">
        <button id="createDuality" class="btn-special">‚ú® Create Duality View</button>
      </div>
      
      <div class="label">üìä Relational Operations</div>
      <div class="button-row">
        <button id="populateSQL" class="btn-primary">üìù Populate Orders (SQL)</button>
        <button id="insertSQL" class="btn-success">‚ûï Insert Order (SQL)</button>
        <button id="updateSQL" class="btn-warning">‚úèÔ∏è Update Order (SQL)</button>
        <button id="querySQL" class="btn-danger">üîç Query Orders (SQL)</button>
      </div>
      
      <div class="label">üîÑ Duality View Operations</div>
      <div class="button-row" id="dualityButtons" style="display:none;">
        <button id="insertJSON" class="btn-primary">‚ûï Insert via JSON</button>
        <button id="updateJSON" class="btn-warning">‚úèÔ∏è Update via JSON</button>
        <button id="queryJSON" class="btn-danger">üîç Query as JSON</button>
        <button id="selectJSON" class="btn-success">üìÑ Select Full Document</button>
      </div>
    </div>
    
    <div class="main-grid">
      <!-- SQL Panel -->
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">üìù SQL Prompt</span>
        </div>
        <div id="sqlDisplay" class="code-display">-- Ready to execute SQL commands
-- Click buttons above to see SQL operations</div>
      </div>
      
      <!-- Tables Panel -->
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">‚äû Relational Tables</span>
        </div>
        <div style="position:relative;">
          <div id="dualityBadge" class="duality-badge">üîÑ DUALITY VIEW ACTIVE</div>
          
          <h4>ORDERS</h4>
          <table>
            <thead>
              <tr><th>ORDER_ID</th><th>CUSTOMER_ID</th><th>STATUS</th><th>TOTAL</th></tr>
            </thead>
            <tbody id="ordersTable">
              <tr><td colspan="4" style="text-align:center; color:#999;">No data yet</td></tr>
            </tbody>
          </table>
          
          <h4>CUSTOMERS</h4>
          <table>
            <thead>
              <tr><th>CUSTOMER_ID</th><th>NAME</th><th>EMAIL</th><th>TIER</th></tr>
            </thead>
            <tbody id="customersTable">
              <tr><td colspan="4" style="text-align:center; color:#999;">No data yet</td></tr>
            </tbody>
          </table>
          
          <h4>ORDER_ITEMS</h4>
          <table>
            <thead>
              <tr><th>ORDER_ID</th><th>PRODUCT_ID</th><th>NAME</th><th>QTY</th><th>PRICE</th></tr>
            </thead>
            <tbody id="itemsTable">
              <tr><td colspan="5" style="text-align:center; color:#999;">No data yet</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- JSON Panel -->
      <div class="panel inactive" id="jsonPanel">
        <div class="panel-header">
          <span class="panel-title">{} JSON Document View</span>
        </div>
        <div id="jsonDisplay" class="code-display">// Duality View not created yet
// Click "Create Duality View" to enable JSON operations</div>
      </div>
    </div>
  </div>
  
  <div id="toast" class="toast"></div>
  
  <script>
    // State
    let dualityCreated = false;
    const orders = [];
    const customers = [];
    const items = [];
    
    // DOM helpers
    function $(id) { return document.getElementById(id); }
    
    function showToast(msg, duration = 2500) {
      const toast = $('toast');
      toast.textContent = msg;
      toast.className = 'toast show';
      setTimeout(() => toast.className = 'toast', duration);
    }
    
    function showSQL(sql) {
      const formatted = sql
        .replace(/(CREATE|TABLE|VIEW|INSERT|INTO|VALUES|UPDATE|SET|WHERE|SELECT|FROM|AS|JSON|OBJECT|AND|OR|PRIMARY|KEY|FOREIGN|REFERENCES|VARCHAR2|NUMBER|REPLACE|RELATIONAL|DUALITY|COMMIT|JOIN|ON)/gi, 
          '<span class="sql-keyword">$1</span>')
        .replace(/('[^']*')/g, '<span class="sql-string">$1</span>')
        .replace(/(\b\d+\.?\d*\b)/g, '<span class="sql-number">$1</span>');
      $('sqlDisplay').innerHTML = formatted;
    }
    
    function showJSON(data) {
      $('jsonDisplay').textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
    }
    
    function updateTables() {
      // Orders table
      const ordersHtml = orders.length > 0 
        ? orders.map(o => `<tr><td>${o.id}</td><td>${o.custId}</td><td>${o.status}</td><td>$${o.total.toFixed(2)}</td></tr>`).join('')
        : '<tr><td colspan="4" style="text-align:center; color:#999;">No orders</td></tr>';
      $('ordersTable').innerHTML = ordersHtml;
      
      // Customers table
      const custHtml = customers.length > 0
        ? customers.map(c => `<tr><td>${c.id}</td><td>${c.name}</td><td>${c.email}</td><td>${c.tier}</td></tr>`).join('')
        : '<tr><td colspan="4" style="text-align:center; color:#999;">No customers</td></tr>';
      $('customersTable').innerHTML = custHtml;
      
      // Items table
      const itemsHtml = items.length > 0
        ? items.map(i => `<tr><td>${i.orderId}</td><td>${i.productId}</td><td>${i.name}</td><td>${i.qty}</td><td>$${i.price.toFixed(2)}</td></tr>`).join('')
        : '<tr><td colspan="5" style="text-align:center; color:#999;">No items</td></tr>';
      $('itemsTable').innerHTML = itemsHtml;
    }
    
    // Button handlers
    $('createDuality').onclick = function() {
      showSQL(`-- Creating JSON Relational Duality View
CREATE OR REPLACE JSON RELATIONAL DUALITY VIEW orders_dv AS
  SELECT JSON {
    'orderId'     : o.order_id,
    'customer'    : {
      'id'        : c.customer_id,
      'name'      : c.name,
      'email'     : c.email,
      'tier'      : c.tier
    },
    'items'       : [
      SELECT JSON {
        'productId' : oi.product_id,
        'name'      : oi.product_name,
        'quantity'  : oi.quantity,
        'price'     : oi.price
      }
      FROM order_items oi
      WHERE oi.order_id = o.order_id
    ],
    'status'      : o.status,
    'totalAmount' : o.total_amount
  }
  FROM orders o
  JOIN customers c ON o.customer_id = c.customer_id;`);
      
      setTimeout(() => {
        dualityCreated = true;
        this.textContent = '‚úì Duality View Created';
        this.disabled = true;
        $('jsonPanel').classList.remove('inactive');
        $('dualityButtons').style.display = 'flex';
        $('dualityBadge').classList.add('show');
        
        if (orders.length > 0) {
          const order = orders[0];
          const cust = customers.find(c => c.id === order.custId);
          const orderItems = items.filter(i => i.orderId === order.id);
          
          showJSON({
            orderId: order.id,
            customer: { id: cust.id, name: cust.name, email: cust.email, tier: cust.tier },
            items: orderItems.map(i => ({ productId: i.productId, name: i.name, quantity: i.qty, price: i.price })),
            status: order.status,
            totalAmount: order.total
          });
        }
        
        showToast('‚ú® Duality View Created! JSON operations now available');
      }, 1500);
    };
    
    $('populateSQL').onclick = function() {
      showSQL(`-- Creating tables
CREATE TABLE customers (
  customer_id VARCHAR2(20) PRIMARY KEY,
  name VARCHAR2(100),
  email VARCHAR2(100),
  tier VARCHAR2(20)
);

CREATE TABLE orders (
  order_id VARCHAR2(20) PRIMARY KEY,
  customer_id VARCHAR2(20),
  status VARCHAR2(20),
  total_amount NUMBER(10,2)
);

CREATE TABLE order_items (
  order_id VARCHAR2(20),
  product_id VARCHAR2(20),
  product_name VARCHAR2(100),
  quantity NUMBER(5),
  price NUMBER(10,2)
);

-- Inserting data
INSERT INTO customers VALUES ('CUST-789', 'Alice Johnson', 'alice@example.com', 'GOLD');
INSERT INTO customers VALUES ('CUST-456', 'Bob Smith', 'bob@example.com', 'SILVER');

INSERT INTO orders VALUES ('ORD-2024-001', 'CUST-789', 'PROCESSING', 107.95);
INSERT INTO orders VALUES ('ORD-2024-002', 'CUST-456', 'SHIPPED', 85.50);

INSERT INTO order_items VALUES ('ORD-2024-001', 'PROD-123', 'Wireless Mouse', 2, 29.99);
INSERT INTO order_items VALUES ('ORD-2024-001', 'PROD-456', 'USB-C Cable', 3, 15.99);
INSERT INTO order_items VALUES ('ORD-2024-002', 'PROD-789', 'Keyboard', 1, 85.50);

COMMIT;`);
      
      orders.length = 0;
      customers.length = 0;
      items.length = 0;
      
      customers.push(
        { id: 'CUST-789', name: 'Alice Johnson', email: 'alice@example.com', tier: 'GOLD' },
        { id: 'CUST-456', name: 'Bob Smith', email: 'bob@example.com', tier: 'SILVER' }
      );
      
      orders.push(
        { id: 'ORD-2024-001', custId: 'CUST-789', status: 'PROCESSING', total: 107.95 },
        { id: 'ORD-2024-002', custId: 'CUST-456', status: 'SHIPPED', total: 85.50 }
      );
      
      items.push(
        { orderId: 'ORD-2024-001', productId: 'PROD-123', name: 'Wireless Mouse', qty: 2, price: 29.99 },
        { orderId: 'ORD-2024-001', productId: 'PROD-456', name: 'USB-C Cable', qty: 3, price: 15.99 },
        { orderId: 'ORD-2024-002', productId: 'PROD-789', name: 'Keyboard', qty: 1, price: 85.50 }
      );
      
      updateTables();
      showToast('Tables populated with sample data');
      
      if (dualityCreated) {
        const order = orders[0];
        const cust = customers.find(c => c.id === order.custId);
        const orderItems = items.filter(i => i.orderId === order.id);
        showJSON({
          orderId: order.id,
          customer: { id: cust.id, name: cust.name, email: cust.email, tier: cust.tier },
          items: orderItems.map(i => ({ productId: i.productId, name: i.name, quantity: i.qty, price: i.price })),
          status: order.status,
          totalAmount: order.total
        });
      }
    };
    
    $('insertSQL').onclick = function() {
      showSQL(`-- Inserting new order
INSERT INTO orders VALUES ('ORD-2024-003', 'CUST-789', 'PENDING', 45.99);
INSERT INTO order_items VALUES ('ORD-2024-003', 'PROD-999', 'Laptop Stand', 1, 45.99);
COMMIT;`);
      
      orders.push({ id: 'ORD-2024-003', custId: 'CUST-789', status: 'PENDING', total: 45.99 });
      items.push({ orderId: 'ORD-2024-003', productId: 'PROD-999', name: 'Laptop Stand', qty: 1, price: 45.99 });
      
      updateTables();
      showToast('New order inserted via SQL');
      
      if (dualityCreated) {
        setTimeout(() => {
          const cust = customers.find(c => c.id === 'CUST-789');
          showJSON({
            orderId: 'ORD-2024-003',
            customer: { id: cust.id, name: cust.name, email: cust.email, tier: cust.tier },
            items: [{ productId: 'PROD-999', name: 'Laptop Stand', quantity: 1, price: 45.99 }],
            status: 'PENDING',
            totalAmount: 45.99
          });
          showToast('JSON view auto-updated!');
        }, 1500);
      }
    };
    
    $('updateSQL').onclick = function() {
      if (orders.length === 0) {
        showToast('Please populate tables first');
        return;
      }
      
      showSQL(`-- Updating order status
UPDATE orders 
SET status = 'SHIPPED' 
WHERE order_id = 'ORD-2024-001';
COMMIT;`);
      
      const order = orders.find(o => o.id === 'ORD-2024-001');
      if (order) {
        order.status = 'SHIPPED';
        updateTables();
        showToast('Order status updated via SQL');
        
        if (dualityCreated) {
          const cust = customers.find(c => c.id === order.custId);
          const orderItems = items.filter(i => i.orderId === order.id);
          showJSON({
            orderId: order.id,
            customer: { id: cust.id, name: cust.name, email: cust.email, tier: cust.tier },
            items: orderItems.map(i => ({ productId: i.productId, name: i.name, quantity: i.qty, price: i.price })),
            status: 'SHIPPED',
            totalAmount: order.total
          });
        }
      }
    };
    
    $('querySQL').onclick = function() {
      if (orders.length === 0) {
        showToast('Please populate tables first');
        return;
      }
      
      showSQL(`-- Query with joins
SELECT 
  o.order_id,
  c.name AS customer_name,
  o.status,
  o.total_amount
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
WHERE o.status IN ('PROCESSING', 'PENDING');

-- Results:
-- ORD-2024-001 | Alice Johnson | PROCESSING | 107.95
-- ORD-2024-003 | Alice Johnson | PENDING | 45.99`);
      
      showToast('Query executed - 2 rows returned');
    };
    
    $('insertJSON').onclick = function() {
      if (!dualityCreated) return;
      
      showSQL(`-- Inserting via JSON Duality View
INSERT INTO orders_dv VALUES ('{
  "orderId": "ORD-2024-004",
  "customer": {
    "id": "CUST-456",
    "name": "Bob Smith",
    "email": "bob@example.com",
    "tier": "SILVER"
  },
  "items": [{
    "productId": "PROD-111",
    "name": "Monitor",
    "quantity": 1,
    "price": 299.99
  }],
  "status": "PENDING",
  "totalAmount": 299.99
}');`);
      
      showJSON({
        orderId: "ORD-2024-004",
        customer: { id: "CUST-456", name: "Bob Smith", email: "bob@example.com", tier: "SILVER" },
        items: [{ productId: "PROD-111", name: "Monitor", quantity: 1, price: 299.99 }],
        status: "PENDING",
        totalAmount: 299.99
      });
      
      orders.push({ id: 'ORD-2024-004', custId: 'CUST-456', status: 'PENDING', total: 299.99 });
      items.push({ orderId: 'ORD-2024-004', productId: 'PROD-111', name: 'Monitor', qty: 1, price: 299.99 });
      
      updateTables();
      showToast('Inserted via JSON ‚Üí Tables auto-updated!');
    };
    
    $('updateJSON').onclick = function() {
      if (!dualityCreated) return;
      
      showSQL(`-- Updating via JSON path
UPDATE orders_dv
SET data = JSON_TRANSFORM(data, 
  SET '$.status' = 'COMPLETED'
)
WHERE JSON_VALUE(data, '$.orderId') = 'ORD-2024-002';`);
      
      const order = orders.find(o => o.id === 'ORD-2024-002');
      if (order) {
        order.status = 'COMPLETED';
        const cust = customers.find(c => c.id === order.custId);
        const orderItems = items.filter(i => i.orderId === order.id);
        
        showJSON({
          orderId: order.id,
          customer: { id: cust.id, name: cust.name, email: cust.email, tier: cust.tier },
          items: orderItems.map(i => ({ productId: i.productId, name: i.name, quantity: i.qty, price: i.price })),
          status: 'COMPLETED',
          totalAmount: order.total
        });
        
        updateTables();
        showToast('Updated via JSON ‚Üí Tables synchronized!');
      }
    };
    
    $('queryJSON').onclick = function() {
      if (!dualityCreated) return;
      
      showSQL(`-- Query returns JSON
SELECT data
FROM orders_dv
WHERE JSON_VALUE(data, '$.status') = 'PROCESSING';`);
      
      const order = orders.find(o => o.status === 'PROCESSING');
      if (order) {
        const cust = customers.find(c => c.id === order.custId);
        const orderItems = items.filter(i => i.orderId === order.id);
        
        showJSON({
          orderId: order.id,
          customer: { id: cust.id, name: cust.name, email: cust.email, tier: cust.tier },
          items: orderItems.map(i => ({ productId: i.productId, name: i.name, quantity: i.qty, price: i.price })),
          status: order.status,
          totalAmount: order.total
        });
        
        showToast('Query returned 1 JSON document');
      }
    };
    
    $('selectJSON').onclick = function() {
      if (!dualityCreated || orders.length === 0) return;
      
      showSQL(`-- Select full JSON document
SELECT JSON_SERIALIZE(data PRETTY) 
FROM orders_dv 
WHERE JSON_VALUE(data, '$.orderId') = 'ORD-2024-001';`);
      
      const order = orders[0];
      const cust = customers.find(c => c.id === order.custId);
      const orderItems = items.filter(i => i.orderId === order.id);
      
      showJSON({
        orderId: order.id,
        customer: { id: cust.id, name: cust.name, email: cust.email, tier: cust.tier },
        items: orderItems.map(i => ({ productId: i.productId, name: i.name, quantity: i.qty, price: i.price })),
        status: order.status,
        totalAmount: order.total,
        _metadata: {
          etag: 'W/"' + Math.random().toString(36).slice(2, 8) + '"',
          lastModified: new Date().toISOString()
        }
      });
      
      showToast('Full JSON document retrieved');
    };
    
    // Initial state
    showToast('Welcome! Start by populating tables or create the Duality View');
  </script>
</body>
</html>